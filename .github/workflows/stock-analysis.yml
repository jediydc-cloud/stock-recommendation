name: ì£¼ì‹ ë¶„ì„ ìë™ ì‹¤í–‰

on:
  schedule:
    # í‰ì¼ ì˜¤ì „ 8ì‹œ (í•œêµ­ì‹œê°„ ê¸°ì¤€, UTC 23:00 = í•œêµ­ì‹œê°„ 08:00)
    - cron: '0 23 * * 1-5'  # ì›”~ê¸ˆìš”ì¼ë§Œ ì‹¤í–‰
  
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ (ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥)

jobs:
  analyze-stocks:
    runs-on: ubuntu-latest
    timeout-minutes: 60  # ğŸ†• ì „ì²´ ì‘ì—… íƒ€ì„ì•„ì›ƒ: 60ë¶„
    
    steps:
    - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3
      
    - name: Python ì„¤ì¹˜
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ì£¼ì‹ ë¶„ì„ ì‹¤í–‰
      id: analyze  # ğŸ†• step ID ì¶”ê°€ (ì—ëŸ¬ í•¸ë“¤ë§ìš©)
      timeout-minutes: 50  # ğŸ†• ë¶„ì„ ë‹¨ê³„ íƒ€ì„ì•„ì›ƒ: 50ë¶„
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        python stock_recommendation_with_exchange.py
      continue-on-error: false  # ğŸ†• ì—ëŸ¬ ë°œìƒ ì‹œ ë‹¤ìŒ ë‹¨ê³„ ì¤‘ë‹¨
        
    - name: ë¡œê·¸ íŒŒì¼ ì €ì¥ (ì—ëŸ¬ ë°œìƒ ì‹œ)
      if: failure()  # ğŸ†• ì‹¤íŒ¨ ì‹œì—ë§Œ ì‹¤í–‰
      uses: actions/upload-artifact@v3
      with:
        name: error-logs
        path: |
          *.log
          output/
        retention-days: 7  # 7ì¼ê°„ ë³´ê´€
        
    - name: ë¶„ì„ ê²°ê³¼ ì—…ë¡œë“œ
      if: success()  # ğŸ†• ì„±ê³µ ì‹œì—ë§Œ ë°°í¬
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./output
        publish_branch: gh-pages
        
    - name: ë¶„ì„ ì™„ë£Œ ì•Œë¦¼
      if: always()  # ğŸ†• í•­ìƒ ì‹¤í–‰ (ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´)
      run: |
        if [ "${{ steps.analyze.outcome }}" == "success" ]; then
          echo "âœ… ì£¼ì‹ ë¶„ì„ ì„±ê³µ!"
          echo "ğŸ“Š ì›¹í˜ì´ì§€: https://jediydc-cloud.github.io/stock-recommendation/"
        else
          echo "âŒ ì£¼ì‹ ë¶„ì„ ì‹¤íŒ¨!"
          echo "ğŸ” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”."
        fi
